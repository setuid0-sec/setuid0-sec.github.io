<html>
    <head>
        <title>setuid(0); Research Team</title>
        <link rel="icon" type="image/png" href="/static/img/favicon.png" sizes="32x32">

        <script src="/static/js/jquery-3.6.0.min.js"></script>

        <link href="/static/semantic/semantic.min.css" rel="stylesheet" />
        <link href="/static/css/halfmoon-variables.min.css" rel="stylesheet" />

        <script src="/static/semantic/semantic.min.js"></script>   


        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/base16/dracula.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
        
        <link href="/static/css/suid.css" rel="stylesheet" />
    </head>

    <body>
        <div class="page-wrapper with-navbar-fixed-bottom">
            <div class="content-wrapper">
                <nav class="navbar">

                    <a href="/home.html" class="navbar-brand">
                        setuid(0);
                    </a>

                    <ul class="navbar-nav d-none d-md-flex"> 
                        <li class="nav-item">
                            <a href="/research.html" class="nav-link">
                                <button class="btn alt-dm active" type="button" style="color:#0FFFFF;">Research</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/art.html" class="nav-link">
                                <button class="btn alt-dm active" type="button" style="color:#FF1493;">Art</button>
                            </a>
                        </li>
                    </ul>

                </nav>

                <div id="pageContent" class="container-fluid">
                    
<div class="w-1000 mw-full">
    <div class="card p-0 bg-very-dark-dm"> 
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        
                        <td><b>ID</b></td>
                        
                        <td><b>Product</b></td>
                        
                        <td><b>Version</b></td>
                        
                        <td><b>Vulnerability</b></td>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        
                        <td>
                            CVE-2019-25023
                        </td>
                        
                        <td>
                            Scytl Secure Vote (sVote)
                        </td>
                        
                        <td>
                            2.1
                        </td>
                        
                        <td>
                            X-Forwarded-For IP-Spoofing/Faking
                        </td>
                        
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>



<div style="margin-left:30px;">
    

    <h1>Description</h1>
	
	
When forward-tracing the applicaton logic one can observe a lot of parameteres implementing the x-forwarded-for headers:
<pre><code class="language-java">@NotNull @Header(PARAMETER_X_FORWARDED_FOR) String xForwardedFor, 
--------------------- 
@NotNull @Header(PARAMETER_X_FORWARDED_FOR) String xForwardedFor,

</code></pre>

This is passed to the following two function: <i>evoting-solution-master/source-code/online-voting-channel/ov-api-gateway/ag-wsrest/src/main/java/com/scytl/products/ov/ag/ui/ws/rs/proxy/XForwardedForFactoryImpl.java</i>
<pre><code class="language-java">@Override     
public String newXForwardedFor(final HttpServletRequest request) {         
    String remoteAddresses = request.getHeader(HEADER);         
    if (remoteAddresses == null) { 
        remoteAddresses = request.getRemoteAddr(); 
    } 
    String localAddress = request.getLocalAddr();         
    return remoteAddresses + ',' + localAddress;     
}
</code></pre>

As well as this one: <i>evoting-solution-master/source-code/online-voting-channel/ov-commons/ov-commonslib/src/main/java/com/scytl/products/ov/commons/util/HttpRequestService.java</i>
<pre><code class="language-java">public String getIpClientAddress(final HttpServletRequest request) { 
    String address = request.getRemoteAddr(); 
    String xForwardedFor = request.getHeader(HTTP_HEADER_X_FORWARDED_FOR);         
    if (xForwardedFor != null && !xForwardedFor.isEmpty()) {             
        int index = xForwardedFor.indexOf(',');             
        if (index > 0) {                 
            address = xForwardedFor.substring(0, index); 
        } else {                 
            address = xForwardedFor; 
        }         
    } 
    return address; 
}
</code></pre>

For both the HttpServletRequest is used directly which includes the client-side "x-forwarded-for" header.
It can be manipulated by a client via, for example, an intercept proxy.

The application uses getIpClientAddress() like this:
<pre><code class="language-java">// transaction id generation         
transactionInfoProvider.generate(tenantId, 
httpRequestService.getIpClientAddress(httpRequestService.getIpServer(request));
</code></pre>

As well as the creation of the xForwardedFor variable like this:
<pre><code class="language-java">String xForwardedFor = xForwardedForFactory.newXForwardedFor(request);</code></pre>
<br />

This newXForwardedFor variable is used all over the place and, for example, written to the internal SPLUNK logs of the application.<br />
An attacker is able to disguise themselves in the logs by manipulating the x-forwarded-for header to a desired ip-address.


    <br />
    <br />

    
    <h2>Timeline</h2>
    <div class="w-700 mw-full">
        <div class="card p-0 bg-very-dark-dm"> 
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td><b>Date</b></td>
                            <td><b>Event</b></td>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <td>
                                February 10 2020
                            </td>
                            <td>
                                Submitted vulnerability to vendor
                            </td>                        
                        </tr>
                        
                        <tr>
                            <td>
                                February 25 2020
                            </td>
                            <td>
                                Vendor moved communication to live PIT platform
                            </td>                        
                        </tr>
                        
                        <tr>
                            <td>
                                February 25 2020
                            </td>
                            <td>
                                Submitted additional details/PoC in live PIT
                            </td>                        
                        </tr>
                        
                        <tr>
                            <td>
                                March 05 2020
                            </td>
                            <td>
                                Vendor acknowledged the vulnerability
                            </td>                        
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    

    
    <h2>Credits</h2>
    <div class="w-400 mw-full">
        <div class="card p-0 bg-very-dark-dm"> 
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td><b>Name</b></td>
                            <td><b>Team</b></td>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <td>
                                Anthony Schneiter
                            </td>
                            <td>
                                SUID
                            </td>                        
                        </tr>
                        
                        <tr>
                            <td>
                                Jannis Kirschner
                            </td>
                            <td>
                                SUID
                            </td>                        
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    



    


    <script>hljs.highlightAll();</script>
    <br />
    <br />
</div>
                </div>
            </div>
            <nav class="navbar navbar-fixed-bottom">
                <div class="navbar-content">
                    <a href="https://twitter.com/_setuid0_"><i class="twitter icon" style="color:white;"></i></a>
                    <a href="https://github.com/setuid0-sec"><i class="github icon" style="color:white;"></i></a>
                </div>
                <a href="#" class="navbar-brand ml-auto" style="font-size:14px; font-weight:normal;"> 
                    setuid(0); Research Team
                </a>
                <span class="navbar-text ml-auto">
                    &copy; setuid(0);
                </span>
                </nav>
        </div>

        <script src="/static/js/halfmoon.min.js"></script>
        <script>
            halfmoon.toggleDarkMode();
        </script>

        <style type="text/css">

            .content-wrapper {
                background-color: rgba(37, 40, 44, 0.9);
            }

            .page-wrapper {
                background-image: url('/static/img/background.gif');
            }

        </style>  

    </body>
</html>