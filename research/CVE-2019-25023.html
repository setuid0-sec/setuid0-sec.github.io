<html>

	<head>
		<link rel="shortcut icon" href="../favicon.ico">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ==" crossorigin="anonymous" />
		<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js" integrity="sha512-dqw6X88iGgZlTsONxZK9ePmJEFrmHwpuMrsUChjAw1mRUhUITE5QU9pkcSox+ynfLhL15Sv2al5A0LVyDCmtUw==" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="../style.css">
	</head>

	<body>

	<div class="ui inverted menu">
		<a class="item" href="../index.html"> <i class="home icon"></i> Home </a>
		<a class="active item" href="../research.html"> <i class="bug icon"></i> Research Publications</a>
		<a class="item" href="../about.html"> <i class="user secret icon"></i> Whoami </a> 
	</div>
	
	
	<div id="releases">
	<table>
	<th>ID</th>
	<th>Product</th>
	<th>Version</th>
	<th>Vulnerability</th>
	<tr>
	<td>CVE-2019-25023</td>
	<td>Scytl Secure Vote (sVote)</td>
	<td>2.1</td>
	<td>X-Forwarded-For IP-Spoofing/Faking</td>
	</tr>
	</table>
	
	<h1>Description</h1>
	
	
	When forward-tracing the applicaton logic one can observe a lot of parameteres implementing the x-forwarded-for headers:
	<code>@NotNull @Header(PARAMETER_X_FORWARDED_FOR) String xForwardedFor, 
--------------------- 
@NotNull @Header(PARAMETER_X_FORWARDED_FOR) String xForwardedFor,

	</code>

	This is passed to the following two function: <i>evoting-solution-master/source-code/online-voting-channel/ov-api-gateway/ag-wsrest/src/main/java/com/scytl/products/ov/ag/ui/ws/rs/proxy/XForwardedForFactoryImpl.java</i>
	<code>@Override     
	public String newXForwardedFor(final HttpServletRequest request) {         
		String remoteAddresses = request.getHeader(HEADER);         
		if (remoteAddresses == null) { 
            remoteAddresses = request.getRemoteAddr(); 
        } 
        String localAddress = request.getLocalAddr();         
		return remoteAddresses + ',' + localAddress;     
	}
	</code>
	
	As well as this one: <i>evoting-solution-master/source-code/online-voting-channel/ov-commons/ov-commonslib/src/main/java/com/scytl/products/ov/commons/util/HttpRequestService.java</i>
	<code>public String getIpClientAddress(final HttpServletRequest request) { 
        String address = request.getRemoteAddr(); 
        String xForwardedFor = request.getHeader(HTTP_HEADER_X_FORWARDED_FOR);         
		if (xForwardedFor != null && !xForwardedFor.isEmpty()) {             
			int index = xForwardedFor.indexOf(',');             
			if (index > 0) {                 
				address = xForwardedFor.substring(0, index); 
            } else {                 
				address = xForwardedFor; 
            }         
		} 
        return address; 
    }
	</code>
	
	For both the HttpServletRequest is used directly which includes the client-side "x-forwarded-for" header.
	It can be manipulated by a client via, for example, an intercept proxy.
	
	The application uses getIpClientAddress() like this:
	<code>// transaction id generation         
	transactionInfoProvider.generate(tenantId, 
	httpRequestService.getIpClientAddress(httpRequestService.getIpServer(request));
	</code>
	
	As well as the creation of the xForwardedFor variable like this:
	<code>String xForwardedFor = xForwardedForFactory.newXForwardedFor(request);</code></br>
	
	This newXForwardedFor variable is used all over the place and, for example, written to the internal SPLUNK logs of the application.</br>
	An attacker is able to disguise themselves in the logs by manipulating the x-forwarded-for header to a desired ip-address.
	
	<h1>Disclosure Timeline</h1>
	<ul>
	<li>Feb 10, 2019 - Submitted vulnerability to vendor </li>
	<li>Feb 25, 2019 - Vendor moved communication to live PIT platform</li>
	<li>Feb 25, 2019 - Submitted additional details/PoC in live PIT</li>
	<li>Mar 05, 2019 - Vendor acknowledged the vulnerability</li>
	</ul>
	<h1>Credit</h1>
	<p>Jannis Kirschner & Anthony Schneiter from Team SUID</p>
	</div>

	</body>
</html>